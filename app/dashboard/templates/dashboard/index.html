{% extends 'dashboard/base.html' %}
{% load bootstrap4 %}

{% load static %}

{% block bootstrap4_extra_head %}    
    <!-- leaflet css -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
        integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
        crossorigin=""/>
    
    <!-- dashboard css -->
    <link rel="stylesheet" href="{% static 'dashboard/dashboard.css' %}">
{% endblock %}

{% block title %}Air Quality Chicago{% endblock %}

{% block content %}
    <h3>Background</h3>
    <p>The <a href="http://elpc.org/" rel="noopener noreferrer" target="_blank">Environmental Law & Policy Center</a> (ELPC) and <a href="#partners">community partners</a> have long been interested in air pollution-related public health issues and their disproportionate effects across Chicago’s neighborhoods. Our goal is improving air quality in the areas most threatened by PM2.5 pollution.</p>
     
    <p>Chicago is a major transportation and economic hub with high concentrations of trains, trucks, and heavy construction equipment. Many of these vehicles pollute the air with harmful particulates (PM2.5) within and around the highways, corridors, rail yards, intermodal facilities, and construction sites where they operate.</p>
     
    <p>Chicago also has very high children’s asthma rates, with some neighborhoods seeing one in every three children affected. Asthma hospitalization rates in Chicago are twice the national rate. COPD and other respiratory illnesses and heart problems are also rampant.<sup><a href="http://www.cityofchicago.org/content/dam/city/depts/cdph/CDPH/CDPHComHlthStatMiniDataFINAL4172015.pdf" title="Hospital Discharge Data, Illinois Department of Public Health, 2011. Web. 21 June 2017." rel="noopener noreferrer" target="_blank">[1]</a></sup></p>
     
    <h3>Understanding PM2.5</h3>
    <p>Particulate matter 2.5 (PM2.5) is a highly toxic air contaminant, composed of a mixture of fine carbon soot particles and gases from a variety of sources such as power plants, idling motor vehicles, construction sites, airplanes, wood burning, fires, and dust.</p>
     
    <p>PM2.5 can affect multiple systems in the human body because it penetrates the body’s natural defenses, and can become lodged in the lungs or enter the bloodstream. This can lead to a wide variety of health problems including: coughs, headaches, lightheadedness, nausea, aggravated allergies, asthma, chronic obstructive pulmonary disease (COPD), and other serious illnesses.<sup><a href="https://oehha.ca.gov/air/health-effects-diesel-exhaust" title="Monserrat, Laurie. &quot;Health Effects of Diesel Exhaust.&quot; OEHHA. N.p., 21 June 2016. 14 July 2017." rel="noopener noreferrer" target="_blank">[2]</a></sup></p>
     
    <p>The <a href="https://airnow.gov/" rel="noopener noreferrer" target="_blank">Environmental Protection Agency</a> (EPA) classifies levels of PM2.5 with a scale of colors and terms that help to signal to people whether they should be concerned about the local air:</p>

    <table class="table table-sm ">
        <thead>
            <tr bgcolor="#f5f5f5">
                <th scope="col">PM2.5 Value</th>
                <th scope="col">Level of Health Concern</th>
                <th scope="col">Meaning</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <th scope="row" bgcolor="#2DA641">0–12 µg/m³</th>
                <td>Good</td>
                <td>Air quality poses little to no risk.</td>
            </tr>
            <tr>
                <th scope="row" bgcolor="#F9DC2E">12–35 µg/m³</th>
                <td>Moderate</td>
                <td>Air quality is good but may begin to be of moderate concern to those with unusual sensitivity to air pollution.</td>
            </tr>
            <tr>
                <th scope="row" bgcolor="#F57F22">35–55 µg/m³</th>
                <td>Unhealthy for Sensitive Groups</td>
                <td>Sensitive groups may experience negative health effects.</td>
            </tr>
            <tr>
                <th scope="row" bgcolor="#F4001C">55+ µg/m³</th>
                <td>Unhealthy for All Groups</td>
                <td>Everyone may begin to experience negative health effects. Sensitive groups especially at risk.</td>
            </tr>
        </tbody>
    </table>
    
    <p>While long term exposure to PM2.5 can affect everyone, children and the elderly are particularly sensitive to the negative health effects caused by air pollution. Children are at an increased risk of asthma and other illnesses after exposure to PM2.5 because their lungs are still developing. Increased respiration during prolonged outdoor activity also contributes to higher PM2.5 intake. The elderly are at high risk for severe aggravation of preexisting chronic respiratory illnesses.</p>
     
    <h3>Data collection and Advocacy</h3>
    <p>Historically, measuring PM2.5 levels required large, expensive, stationary monitoring equipment operated by the EPA, government contractors, or research labs. These sensors and resulting data are often inaccessible to the public, and lack the flexibility to assess local conditions.</p>
     
    <p>New <a href="http://www.takingspace.org/aircasting/airbeam/" rel="noopener noreferrer" target="_blank">handheld particulate monitoring</a> technology is easy to use and generates transparent, <a href="http://aircasting.org/map" rel="noopener noreferrer" target="_blank">publicly-available</a> information. These allow ELPC and our community partners to launch efforts to advocate for cleaner practices and equipment at construction sites, inform traffic management patterns, influence public transportation operations, enforce local anti-idling ordinances, and allow residents to make better-informed decisions to limit their exposure to particulate matter pollution.</p>
     
    <h3 id="partners">Our Partners</h3>
    <p>Data displayed on Air Quality Chicago is a collaborative effort of ELPC, public health allies, and community organizations. Our partners include:</p>
   
    <table class="table table-sm text-center partners">
        <tbody>
            <tr>
                <td><a href="https://experimentalstation.org/market/" title="61st Street Farmers Market"><img src="{% static 'dashboard/img/61stStreetFarmersMarket.jpg' %}"></img></a></td>
                <td><a href="https://www.facebook.com/GreenerSouthLoop/" title="Alliance for a Greener South Loop"><img src="{% static 'dashboard/img/AGreenerSouthLoop.png' %}"></img></a></td>
                <td><a href="https://experimentalstation.org/blackstone/" title="Blackstone Bicycle Works"><img src="{% static 'dashboard/img/BlackstoneBicycleWorks.jpg' %}"></img></a></td>
                <td><a href="http://cps.edu" title="Chicago Public Schools"><img src="{% static 'dashboard/img/ChicagoPublicSchools.jpg' %}"></img></a></td>
            </tr>
            <tr>
                <td><a href="http://cutcatscourier.com/ title="Cut Cats Courier"><img src="{% static 'dashboard/img/CutCatsCourier.png' %}"></img></a></td>
                <td><a href="https://delta-institute.org/" title="Delta Institute"><img src="{% static 'dashboard/img/DeltaInstitute.jpg' %}"></img></a></td>
                <td><a href="https://experimentalstation.org/" title="Experimental Station"><img src="{% static 'dashboard/img/ExperimentalStation.jpg' %}"></img></a></td>
                <td><a href="https://www.fieldmuseum.org/at-the-field/programs/chicago-green-ambassadors-program" title="Field Museum’s Green Ambassadors"><img src="{% static 'dashboard/img/FieldMuseum.jpg' %}"></img></a></td> 
            </tr>
            <tr>
                <td><a href="http://justdesigncoop.org/" title="JustDesign Cooperative, LLC"><img src="{% static 'dashboard/img/JustDesign.png' %}"></img></a></td>
                <td><a href="https://www.fieldmuseum.org/science/research/area/keller-science-action-center" title="Keller Science Action Center"><img src="{% static 'dashboard/img/FieldMuseum.jpg' %}"></img></a></td>
                <td><a href="https://experimentalstation.org/linkup-overview/" title="LINK Up Illinois"><img src="{% static 'dashboard/img/LinkUpIllinois.jpg' %}"></img></a></td>
                <td><a href="https://www.mapscorps.org/" title="MAPSCorps"><img src="{% static 'dashboard/img/MapsCorps.jpg' %}"></img></a></td>
            </tr>
            <tr>
                <td></td>
                <td><a href="http://setaskforce.org/" title="Southeast Environmental Task Force"><img src="{% static 'dashboard/img/SETaskForce.jpg' %}"></img></a></td>
                <td><a href="http://plantchicago.org/" title="Plant Chicago"><img src="{% static 'dashboard/img/PlantChicago.png' %}"></img></a></td>
                <td></td>
            </tr>
        </tbody>
    </table>
    
    <h3>Our Coverage</h3>
    
    <div id="id_map">
    </div>

    <p>If you notice a lack of monitoring coverage in your area and would like to know more about or get involved in the Air Quality Chicago Monitoring Program, please contact <a href="mailto:twerner@elpc.org?Subject=Air%20Quality%20Chicago" target="_top">Tiffany Werner</a>.</p>

{% endblock %}


{% block bootstrap4_extra_script %}
    <!-- leaflet js -->
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
       integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
       crossorigin="">
    </script>
    
    <!-- leaflet easyPrint -->
    <script src=" https://cdn.rawgit.com/rowanwins/leaflet-easyPrint/gh-pages/dist/bundle.js">
    </script>
    
    <!-- leaflet spin -->
    <script src="https://cdn.rawgit.com/makinacorpus/Leaflet.Spin/gh-pages/spin/spin.js" charset="utf-8"></script>
    <script src="https://cdn.rawgit.com/makinacorpus/Leaflet.Spin/gh-pages/leaflet.spin.min.js" charset="utf-8"></script>
    
    <!-- leaflet heat -->
    <script src="https://cdn.rawgit.com/Leaflet/Leaflet.heat/gh-pages/dist/leaflet-heat.js" charset="utf-8"></script>
    
    <!-- dashboard functions -->
    <script src="{% static 'dashboard/dashboard.js' %}"  type="text/javascript">
    </script>

    <script>
        /*----------------------------------------------------------------------------
          global vars setup
         *----------------------------------------------------------------------------*/    
        var sampleSize = 5000;
        
        /*----------------------------------------------------------------------------
          map setup
         *----------------------------------------------------------------------------*/
        var attribution = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>';
        var accessToken = 'pk.eyJ1IjoiZHJ3YWhsIiwiYSI6ImNqOG9zN25nYTA3dG8ycXJzNGpqbmE3cTgifQ.mNd1sk4ymlt8lvZTwKADOA';
        
        // tile layers
        var streets = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: attribution,
            id: 'mapbox.streets',
            accessToken: accessToken,
        });
        
        var light = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: attribution,
            id: 'mapbox.light',
            accessToken: accessToken,
        });
        
        // layer groups
        var geo = L.layerGroup([]);
        
        // map
        var map = L.map('id_map', {
            center: [41.8781, -87.6298],
            zoom: 11,
            maxZoom: 13,
            minZoom: 11,
            preferCanvas: true,
            layers: [streets, geo],
        });
        
        // control layers
        var baseMaps = {
            "Streets": streets,
            "Light": light,
        };
        
        var overlayMaps = {
            "Geo": geo,
        };
        
        L.control.layers(baseMaps, overlayMaps).addTo(map);
        
        var printPlugin = L.easyPrint({
      		sizeModes: ['Current', 'A4Landscape', 'A4Portrait'],
      		filename: 'map',
      		exportOnly: true,
      		hideControlContainer: true
		}).addTo(map);
        
        /*----------------------------------------------------------------------------
          document ready callback
         *----------------------------------------------------------------------------*/   
        $(document).ready(function() {
            //console.log("ready");
            
            // get measurements sample
            getMeasurements({
                'sample_size': sampleSize,
                }, measurementsCallback);
            
            // start spin
            map.spin(true);
        });
        
        /*----------------------------------------------------------------------------
          map measurements
         *----------------------------------------------------------------------------*/
        function measurementsCallback(data) {
            var measurements = JSON.parse(data['measurements']);
            //console.log(measurements);

            // iterate through measurements, maps
            var latlngs = [];
            for (i = 0; i < measurements.length; ++i) {
                // circle properties
                var latlng = [measurements[i]['fields']['latitude'], measurements[i]['fields']['longitude']];
                latlngs.push(latlng);
            }
            
            // create heat layer, add to geo layer
            var heat =  L.heatLayer(latlngs, {
                gradient: {0.4: '#FFFFFF', 1: coverageColor},
                maxZoom: 13,
                radius: 25,
                blur: 50,
            });
            geo.addLayer(heat);
            
            // stop spin
            map.spin(false);
        } 
    </script>
{% endblock %}
